# needed for autogenerated headers
find_package (Python3 COMPONENTS Interpreter)

add_custom_target(tagger)
add_custom_command(TARGET tagger PRE_BUILD COMMAND ${CMAKE_COMMAND} -E copy_directory "\"${CMAKE_SOURCE_DIR}/Docs&Tools/Tagger\"" "\"${CMAKE_CURRENT_BINARY_DIR}\"")
add_custom_command(TARGET tagger PRE_BUILD COMMAND ${CMAKE_COMMAND} -E copy "\"${CMAKE_SOURCE_DIR}/Resources/Data/ImageTypes.xml\"" "\"${CMAKE_CURRENT_BINARY_DIR}\"")
add_custom_command(TARGET tagger PRE_BUILD COMMAND ${CMAKE_COMMAND} -E copy "\"${CMAKE_SOURCE_DIR}/Resources/Data/ImageFiles.xml\"" "\"${CMAKE_CURRENT_BINARY_DIR}\"")

find_program(PYINSTALLER pyinstaller)
if(UNIX)
    set(PYINSTALLER_PATH_SEP ":")
else()
    set(PYINSTALLER_PATH_SEP ";")
endif()
# custom target to built the tagger
# important: the main file cannot have the name tagger, as that is the name of the module, which breaks pyinstaller
add_custom_command(
        TARGET tagger
        COMMAND "${PYINSTALLER}" "main.py" -n "Tagger" --onefile --noconfirm --add-data "ImageTypes.xml${PYINSTALLER_PATH_SEP}." --add-data "ImageFiles.xml${PYINSTALLER_PATH_SEP}."
        --exclude-module PySide2 --exclude-module PyQt5 --exclude-module PyQt6 --exclude-module IPython --exclude-module pandas --exclude-module scipy   # these would be picked up by matplotlib, if they are installed, we ignore them so we don't bloat the exe too much
)
